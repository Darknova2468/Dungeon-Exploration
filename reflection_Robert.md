# Robert Yang - Project Reflection

## Advice

There's lots of advice that I would definitely give myself, but the most important ones are:
- Not putting as much on the needs to have list
- Doing documentation much earlier (seriously, this is painful last-minute)

## Completion of Needs to Have List



## The Hardest Part

The most difficult part was definitely the dungeon generation. Although other major objectives such as entities and UIs took plenty of time, the generation was particularly challenging in the algorithms required to get it to work, the specifics of placement, and the creative application of such algorithms in a proper way. For this project, we wished to find a way to combine randomly generated rooms, staircases, and twisting labyrinths, while also having both a sense of progression and an overall compactness to the dungeon. Some of the framework came from a previous project; specifically, in a game I made earlier, called Cave Dungeons, I used Prim's algorithm to simulate labyrinths and celluar automata to simulate caves. However, these were somewhat randomly combined through Perlin noise and the ability for the player to mine through walls; this was undesirable for the current project since we didn't want the player to mine through walls and potentially miss or cheese certain stages.

Although we initially had disagreements about how the overall generation would work, we eventually used Alex's idea of having a progression of randomly generated rooms, separated by labyrinths and staircases. The first step was to determine each room's position such that the dungeon would fit neatly together. We did this by creating an ordered list of abstract (position-less) rooms and assigning the edge connections from each room with length based on type of edge. Then, we were able to use the cosine law to position the rooms in the correct locations, such that each sequence of three consecutive rooms would form a triangle. Thus, we were able to determine the positions of each room.

After this, we proceeded to generate the cave nodes and cave edges. Specifically, the cave node rooms are generated by creating two concentric circles; the region inner circle is made completely blank without walls, while the region between the circles is randomly filled. Afterwards, celluar automata is used to smoothen the edges, while flood fill ensures that only one room exists. The staircase cave edges, on the other hand, are just rectangle rasterizations using linear algebra.

Then, we needed to deal with labyrinths. To do so, we first had to specify zones that the labyrinths would be contained within. This was done by specifying multiple bounds:
- The labyrinth cannot go outside the dungeon boundaries defined by the nodes.
- The labyrinth cannot touch previously generated whitespaces sufficiently far away from the two nodes it connected.
- The labyrinth can only touch each node once, to prevent the player from getting extremely confused.
- If the labyrinth connects to a cave node on the convex hull of all cave nodes, then the labyrinth must be bounded by the line from the node to the closest point on the edge of the map, to prevent the labyrinth from twisting around the cave node.
- The labyrinth cannot touch other labyrinths. For this, if there were two labyrinths that connected to the same node, they would be separated by the median of the triangle of the three nodes that the labyrinths connect to.
- Finally, the labyrinth must be bounded by a circle, for aesthetic reasons.

These were not so easy to implement. In particular, the restriction of labyrinths only touching each node once cost lots of pain and effort in figuring out why the algorithm occasionally failed to do so. Furthermore, one restriction required the use of convex hulls, which also took some time to implement. However, these conditions were eventually completed.

Finally, there were many bugs along the way that needed to be fixed. Many of them where fundamental but obscure, such as rooms not placing where they should, or the game suddenly crashing when the player goes too far up. Those required lots of time to fix, and we also had to resort to corrupted dungeon regeneration in cases where the dungeon does not generate correctly. However, we haven't noticed any glitch in dungeon generation for at least a month now, so we've likely patched most, if not all, problems regarding generation.